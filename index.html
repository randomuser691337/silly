<!DOCTYPE html>
<html>

<head>
    <title>WebDesk</title>
    <link rel="shortcut icon" href="./assets/img/favicon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <link rel="stylesheet" href="./assets/core.css">
    <script>
        var ver = "0.0.9";
        var lastedit = "Feb 1, 2024";
        var crashed = false;
        function panic(cont) {
            writevar('panic', cont, 'r');
            delvar('bootload');
            crashed = true;
            console.log('Panicking: ' + cont);
        }
        console.log(`%c== WebDesk ${ver} ==%cLast edited ${lastedit}%c%cDo not type or paste anything in this menu. Doing so may compromise WebDesk.`,
            "color: #AAF; font-size: 22px",
            "color: #DAF; font-size: 17px",
            "", // Reset formatting to default
            "color: #FAA; font-size: 14px"
        );
    </script>
</head>

<body>
    <div class="fullbg" id="nest">
        <div class="setup" id="setup">
            <div id="setup1" style="max-width: 330px; display: none;">
                <p class="h2">Welcome to WebDesk!</p>
                <p>In just a few steps, you'll be ready to go.</p>
                <p class="smt">- Select "Migrate" if you want to copy data</p>
                <p class="smt">- Select "Let's Go" to get started (normal)</p>
                <p class="smt">- Select "Guest" to skip setup or debug</p>
                <button class="b1" onclick="guestmode();">Guest</button><button class="b1"
                    onclick="fesw('setup1', 'mig');">Migrate</button><button class="b1"
                    onclick="fesw('setup1', 'setup2');">Let's go!</button>
                <p class="rsmt" style="margin-top: 4px;"><span class="ver"></span> - <span class="lastedit"></span></p>
            </div>
            <div id="setup2" style="display: none; max-width: 320px;">
                <p class="h2">User Setup</p>
                <p>Enter a username and select your preferences.</p>
                <input type="text" id="username" class="i1" placeholder="Enter a new username" autocomplete="off">
                <p class="smt">Select the options below to toggle them (green is on, red is off)</p>
                <button class="thingy green" onclick="setchk('sendcrashs', 'yescrd', 'nocrd');" id="sendcrashs">Allow
                    sending crash details to the dev</button>
                <button class="thingy red" onclick="setchk('senderrors', 'yeserrd', 'noerrd');" id="senderrors">Allow
                    sending error details to the dev</button>
                <button class="b1" onclick="fesw('setup2', 'setup1');">Back</button><button class="b1"
                    onclick="fesw('setup2', 'setup3');">Done!</button>
            </div>
            <div id="setup3" style="display: none; max-width: 230px;">
                <p class="h2">Personalize</p>
                <p>Accent color</p>
                <button class="acb" style="background: rgb(210, 30, 30);" onclick="chacc('210, 30, 30');"></button>
                <button class="acb" style="background: rgb(210, 120, 30);" onclick="chacc('210, 120, 30');"></button>
                <button class="acb" style="background: rgb(210, 180, 20);" onclick="chacc('210, 180, 20');"></button>
                <button class="acb" style="background: rgb(50, 160, 20);" onclick="chacc('50, 160, 20');"></button>
                <button class="acb" style="background: rgb(40, 70, 235);" onclick="chacc('40, 70, 235');"></button>
                <button class="acb" style="background: rgb(120, 60, 235);" onclick="chacc('120, 60, 235');"></button>
                <p><button class="b1" onclick="fesw('setup3', 'setup2');">Back</button><button class="b1"
                        onclick="finishsetup();nametime('username');">Done!</button></p>
            </div>
            <div id="setup4" style="display: none; max-width: 320px;">
                <p class="h2">Setup is done!</p>
                <p>Finishing up a few things...</p>
                <button class="b1" onclick="window.location.reload();">Reload</button>
            </div>
            <div id="mig" style="max-width: 330px; display: none;">
                <p class="h2" id="lobotomy">Migration Assistant</p>
                <p>Note: Safari can have issues migrating.</p>
                <p class="smt">- Go to your Everything Menu and open Migration Assistant on the other WebDesk.</p>
                <p class="smt">- Enter the code "<span id="codemig" style="color: #fff;"></span>" into the Assistant.
                </p>
                <button class="b1" onclick="fesw('mig', 'setup1');">Back</button>
            </div>
            <div id="load" style="max-width: 320px;">
                <p class="h2">Loading...</p>
                <p>If this gets stuck or takes too long, reload.</p>
                <button class="b1" onclick="recovery();">Recovery</button><button class="b1"
                    onclick="reboot();">Reload</button>
            </div>
            <div id="mdone" style="max-width: 300px; display: none;">
                <p class="h2">Migration Assistant</p>
                <p>Migration complete.</p>
                <p>Click "Done" to reboot into your WebDesk.</p>
                <button class="b1" onclick="reboot();">Done</button>
            </div>
        </div>
        <!--Migration Assistant-->
        <div class="window" id="migration" style="width: 350px;">
            <div class="title-bar" id="titleBar">Migration Assistant <button class="winb wc"
                    onclick="hidef('migration');">Close</button></div>
            <div class="content">
                <p>Enter the ID of the other WebDesk.</p>
                <p>Do not enter any other person's ID, as your data will go to them!</p>
                <input type="text" id="peerIdInput" class="i1" placeholder="Other peer's ID">
                <button
                    onclick="mkw(`<p>If migration won't start</p><p>- Try reloading this WebDesk, then reopen Migration Assistant and try again.</p><p>- Make sure you're on the same network as the other WebDesk.</p>`, 'Migration Assistant', '350px');"
                    class="b1">Not working?</button><button id="connectButton" class="b1">Connect</button>
            </div>
            <div class="content" style="display: none" id="migrationdontclose">
                <p>Sending data to other WebDesk...</p>
                <p>The other WebDesk will let you know when migration is done.</p>
                <p>When it's done, close this window.</p>
            </div>
        </div>
        <!--End of Migration Assistant-->
        <!--Settings-->
        <div class="window" id="settings" style="width: 260px;">
            <div class="title-bar" id="titleBar">Settings <button class="winb wc"
                    onclick="hidef('settings');">Close</button>
            </div>
            <div class="content">
                <div id="settingsmain">
                    <button class="b1 b2" onclick="fesw('settingsmain', 'settingsappear');">Appearance</button><button
                        class="b1 b2" onclick="fesw('settingsmain', 'settingsgen');">General</button><button
                        class="b1 b2" onclick="fesw('settingsmain', 'settingspriv');">Data & Privacy</button>
                </div>
                <div id="settingsappear" style="display: none;">
                    <p style="margin: 0px !important;">Accent color</p>
                    <button class="acb" style="background: rgb(210, 30, 30);" onclick="chacc('210, 30, 30');"></button>
                    <button class="acb" style="background: rgb(210, 120, 30);"
                        onclick="chacc('210, 120, 30');"></button>
                    <button class="acb" style="background: rgb(210, 180, 20);"
                        onclick="chacc('210, 180, 20');"></button>
                    <button class="acb" style="background: rgb(50, 160, 20);" onclick="chacc('50, 160, 20');"></button>
                    <button class="acb" style="background: rgb(40, 70, 235);" onclick="chacc('40, 70, 235');"></button>
                    <button class="acb" style="background: rgb(120, 60, 235);"
                        onclick="chacc('120, 60, 235');"></button>
                    <p>Other</p>
                    <p><button class="winb" onclick="fesw('settingsappear', 'settingsmain');">Back</button></p>
                </div>
                <div id="settingspriv" style="display: none;">
                    <p>Data & Privacy</p>
                    <button class="b1"
                        onclick="mkw(`<p>Warning: Erasing WebDesk will delete all of it's data. Select 'Close' to stop, or 'Erase' to continue.</p><button class='b1 b2' onclick='burnitall();'>Erase</button>`, 'Erase Assistant', '330px');">Erase
                        This WebDesk</button>
                    <p><button class="winb" onclick="fesw('settingspriv', 'settingsmain');">Back</button></p>
                </div>
                <div id="settingsgen" style="display: none;">
                    <p>General</p>
                    <button class="b1" onclick="repop();">Enter recovery mode (Alt+I)</button>
                    <p><button class="winb" onclick="fesw('settingsgen', 'settingsmain');">Back</button></p>
                </div>
            </div>
        </div>
        <!--End of settings-->
        <!--Camera-->
        <div class="window" id="camera" style="width: 280px;" ver="1.0">
            <div class="title-bar" id="titleBar"><span class="camtime" style="pointer-events: none;">Camera</span>
                <button class="winb wc"
                    onclick="hidef('camera');nocam();fesw('cameraitself', 'enablecam');">Close</button>
            </div>
            <div class="content">
                <div id="enablecam">
                    <p>WebDesk needs camera permission to open this app.</p>
                    <p>Note: iOS has (seemingly) unfixable issues.</p>
                    <button class="b1" onclick="stcam();fesw('enablecam', 'cameraitself');">Grant</button>
                </div>
                <div id="cameraitself" style="display: none;">
                    <video autoplay="true" id="videl"></video>
                    <button class="b1" onclick="nocam();fesw('cameraitself', 'enablecam');">Back</button><button
                        class="b1" onclick="snap();">Take Picture</button><button class="b1"
                        onclick="fesw('cameraitself', 'snapper');">Timer</button>
                </div>
                <div id="snapper" style="display: none;">
                    <p>Timer</p>
                    <p>Click one of the options below to start a photo timer</p>
                    <button class="b1" onclick="tsnap(3000, 3);">3s</button><button class="b1"
                        onclick="tsnap(6000, 6);">6s</button><button class="b1"
                        onclick="tsnap(9000, 9);">9s</button><button class="b1" onclick="tsnap(12000, 12);">12s</button>
                </div>
            </div>
            <script src="./assets/apps/camera.js"></script>
        </div>
        <!--End of camera-->
        <!--Terminal-->
        <div id="terminal" class="window resizeh" name="Terminal" style="width: 300px;">
            <div class="title-bar">Terminal <button class="winb wc" onclick="hidef('terminal');">Close</button><button
                    class="winb" id="run" onclick="document.getElementById('terminalbox').value = '';">Clear</button>
            </div>
            <div class="content">
                <input id="terminalbox" placeholder="Run any JS function" class="i1">
                <button class="b1" onclick="executeCode();" style="margin-bottom: 1px;">Execute</button>
                <script>
                    function executeCode() {
                        var code = document.getElementById("terminalbox").value;
                        eval(code);
                    }
                </script>
            </div>
        </div>
        <!--End of terminal-->
        <!--Weather-->
        <div id="weather" class="window resizeh" name="Browser" style="width: 300px;">
            <div class="title-bar">Weather <button class="winb wc" onclick="hidef('weather');">Close</button><button
                    class="winb wc" onclick="reboot();">Restart</button>
            </div>
            <div class="content" id="weathers1">
                <p>1. Input your city first.</p>
                <input id="weathercity" placeholder="Enter a city here" class="i1">
                <p>2. Select the unit you use.</p>
                <button class="b1" onclick="getWeather('weathercity', 'imperial');">Fahrenheit</button><button
                    class="b1" onclick="getWeather('weathercity', 'metric');">Celsius</button>
                <script src="./assets/apps/weather.js"></script>
            </div>
            <div class="content" id="weathers2" style="display: none;">
                <p class="weathera"></p>
                <button class="b1" onclick="fesw('weathers2', 'weathers1');">Reconfigure</button>
            </div>
        </div>
        <!--End of weather-->
        <!--Browser-->
        <div id="browser" class="window resizeh" name="Browser" style="width: 700px;">
            <div class="title-bar">Browser
                <button class="winb wc" onclick="hidef('browser');">Close</button><button class="winb"
                    onclick="fesw('browser2', 'browser1');">Page Error</button><button class="winb"
                    onclick="browsergo();">Go!</button><button class="winb" onclick="browseback();">Back</button><button
                    class="winb" onclick="browseforward();">Forward</button>
            </div>
            <div class="content">
                <div id="browser1" style="display: none;">
                    <p>To view most websites, you'll need to add a small tool to your Chrome/Edge browser.</p>
                    <p>This tool helps WebDesk load websites that normally don't let you view them in a certain way.</p>
                    <p>After you add it, come back here! You'll be shown how to enable it (it's easy).</p>
                    <button onclick="fesw('browser1', 'browser2');" class="b1">Back</button><button class="b1"
                        onclick="fesw('browser1', 'browser3');">Add Tool</button>
                </div>
                <div id="browser2">
                    <input class="i1" placeholder="Link here, then select 'Go!'" id="browserlink">
                    <embed class="embed" height="400px" src="./assets/browser.html" id="browserframe"></embed>
                </div>
                <div id="browser3" style="display: none;">
                    <p>Please enable the extension by:</p>
                    <p>- Installing the extension by <a
                            onclick="redir(`https://chromewebstore.google.com/detail/allow-x-frame-options/jfjdfokifdlmbkbncmcfbcobggohdnif`);">selecting
                            this</a> (works on anything Chrome-base)</p>
                    <p>- Opening the Extension menu (the puzzle piece in your URL bar)</p>
                    <p>- Clicking "Allow X-Frame Options" (in the menu you opened)</p>
                    <p>- Clicking "Toggle ON/OFF" (bottom left corner)</p>
                    <p>When you're done, reboot to apply to WebDesk. Browser will auto-open.</p>
                    <button class="b1" onclick="fesw('browser3', 'browser1');">Back</button>
                    <button class="b1" onclick="writevar('auto-open', 'browser'); writevar('brsetup', 't', 'r');">All
                        done!</button>
                </div>
            </div>
        </div>
        <script>
            var iframe = document.getElementById("browserframe");
            var visitedUrls = [];
            var currentIndex = -1;

            function browseback() {
                if (currentIndex > 0) {
                    currentIndex--;
                    iframe.src = visitedUrls[currentIndex];
                }
            }

            function browseforward() {
                if (currentIndex < visitedUrls.length - 1) {
                    currentIndex++;
                    iframe.src = visitedUrls[currentIndex];
                }
            }

            iframe.addEventListener("load", function () {
                if (currentIndex === -1 || iframe.src !== visitedUrls[currentIndex]) {
                    visitedUrls.splice(currentIndex + 1);
                    visitedUrls.push(iframe.src);
                    currentIndex++;
                }
            });
        </script>
        <!--End of browser-->
        <!--Calculator-->
        <div id="calculator" class="window">
      <div class="title-bar">Calculator
        <button class="winb wc" onclick="hidef('calculator');">Quit</button><button class="winb wc" id="clrcmd" onclick="clr();">Clear</button>
      </div>
      <div class="content">
        <div id="calculator2" style="text-align: center;">
          <script type="text/javascript">
            function dis(val) {
              document.getElementById("result").value += val;
            }

            function solve() {
              let x = document.getElementById("result").value;
              let y = eval(x);
              document.getElementById("result").value = y;
            }

            function clr() {
              document.getElementById("result").value = "";
            }
          </script>
          <style>
            input[type="button"] {
              color: var(--font);
              width: 55px;
              height: 55px;
              transition: .1s;
              font-size: 16px;
              font-family: 'Poppins', sans-serif;
              background-color: transparent;
              border-radius: 6px;
              cursor: pointer;
              border: none;
            }

            input[type="button"]:hover {
              color: rgba(var(--accent));
              border-radius: 7px;
            }

            input[type="button"]:active {
              color: rgba(var(--accent), .60);
              border-radius: 7px;
            }

            #result {
              box-sizing: border-box;
              font-size: 16px;
              font-family: 'Poppins', sans-serif;
              border: none;
              background-color: transparent;
              border-radius: 6px;
              outline: none;
              color: var(--font);
              text-align: center;
              width: 210px;
            }
          </style>
          <p><input class="calctext txttop txtbtm" type="text" id="result" placeholder="Type an equation..." onfocus="this.blur();"></p>
          <p><input type="button" value="1" onclick="dis('1')">
            <input type="button" value="2" onclick="dis('2')">
            <input type="button" value="3" onclick="dis('3')">
            <input type="button" value=":|:" onclick="dis('/')">
          </p>
          <p><input type="button" value="4" onclick="dis('4')">
            <input type="button" value="5" onclick="dis('5')">
            <input type="button" value="6" onclick="dis('6')">
            <input type="button" value="-" onclick="dis('-')">
          </p>
          <p><input type="button" value="7" onclick="dis('7')">
            <input type="button" value="8" onclick="dis('8')">
            <input type="button" value="9" onclick="dis('9')">
            <input type="button" value="+" onclick="dis('+')">
          </p>
          <p><input type="button" value="." onclick="dis('.')">
            <input type="button" value="0" onclick="dis('0')">
            <input type="button" value="=" onclick="solve()">
            <input type="button" value="x" onclick="dis('*')">
          </p>
        </div>
      </div>
    </div>
        <!--End of calculator-->
        <!--Desktop nav-->
        <button id="mainbtn" class="cent" onclick="toggle('mainmenu');"><svg xmlns="http://www.w3.org/2000/svg"
                width="24" height="16" viewBox="0 0 24 16" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-more-horizontal">
                <circle cx="12" cy="10" r="1"></circle>
                <circle cx="19" cy="10" r="1"></circle>
                <circle cx="5" cy="10" r="1"></circle>
            </svg> <span class="time">Time</span></button>
        <div id="mainmenu">
            <div class="content"
                style="padding: 6px; border-radius: var(--rad2); background-color: rgba(var(--accent), 0.08);">
                <p class="h3"><span class="greet">Welcome to WebDesk</span>, <span class="user"></span>!</p>
                <p class="smt weather" onclick="opapp('weather');">Select to set up weather</p>
                <p class="h2">Apps</p>
                <div class="padmenu">
                    <button class="b1" onclick="opapp('migration');">Migration Assistant</button><button class="b1"
                        onclick="opapp('settings');">Settings</button><button class="b1"
                        onclick="opapp('camera');">Camera</button><button class="b1"
                        onclick="opapp('terminal');">Terminal</button><button class="b1"
                        onclick="opapp('weather');">Weather</button><button class="b1"
                        onclick="opapp('browser');">Browser</button>
                </div>
                <p class="h2">WebDesk</p>
                <div class="padmenu">
                    <button class="b1 b2" onclick="about();hidef('mainmenu');">About WebDesk</button>
                    <button class="b1 b2" onclick="reboot();">Reboot</button>
                    <button class="b1 fucku" onclick="cleantop();">Clean Desktop</button><button class="b1 fucku"
                        onclick="hidef('mainmenu');">Close</button>
                </div>
            </div>
        </div>
        <!--End of desktop nav-->
    </div>
    <script src="./assets/apps/loosecode.js"></script>
    <script src="./assets/code/jq.js"></script>
    <script src="./assets/code/idb.js"></script>
    <script src="./assets/code/core.js"></script>
    <script src="./assets/code/ui.js"></script>
    <script src="./assets/code/peer.js"></script>
    <script src="./assets/code/mico.js"></script>
    <script src="./assets/code/rec.js"></script>
    <script>
        let started = false;
        document.onreadystatechange = async function () {
            try {
                if (started === true) {
                    console.log('- Rejected doc.onreadychange (shortened)');
                    return;
                } else {
                    started = true;
                    const bl = await readvar('bootload');
                    if (bl) {
                        console.log('- Bootload has code! Executing...');
                        try {
                            eval(bl);
                        } catch (error) {
                            console.log('- Bootload has shat itself!');
                            mkw(`<p>WebDesk may have failed to load, due to the bootload variable.</p>
                           <p>Select an option to try to fix this.</p>
                           <button class="b1" onclick="mkw('${error}', 'Error Details', '290px');">View Error</button><button
                            class="b1" onclick="wipeboot();">Wipe bootload</button><button
                            class="b1" onclick="recovery();">Recovery</button>`, 'Database', '360px');
                        }
                    }
                    const setup = await readvar('setupdone');
                    const wd = await readvar('wd');
                    const accent = await readvar('accent');
                    const ao = await readvar('auto-open');
                    if (setup == "y") {
                        const hewwo = await readvar('name');
                        if (hewwo == "" || hewwo == undefined) {
                            dest('setup');
                            nameutil(`<p>You didn't set a name during setup.</p><p>Please set one now!</p>`);
                        } else {
                            desktop(hewwo); masschange('greet', 'Hi there');
                            send(`Someone is using WebDesk as "${hewwo}" from`);
                        }
                    } else if (setup == "guest") {
                        burnitall('Guest Mode');
                    } else {
                        fesw('load', 'setup1');
                    }
                    if (accent) {
                        chacc(accent);
                    }
                    if (wd) {
                        const w1 = await readvar('city');
                        const w2 = await readvar('unit');
                        getWeather(w1, w2);
                    }
                    if (ao) {
                        opapp(ao);
                        delvar('auto-open');
                    }
                    masschange('lastedit', lastedit);
                    masschange('ver', ver);
                    // applications here
                    console.log('- Successful boot!');
                }
            } catch (error) {
                mkw(`<p>WebDesk encountered a critical error.</p><p>You can use Recovery, or try again.</p><button class="b1" onclick="mkw('${error}', 'Error Details', '280px');">View Error</button><button class="b1" onclick="recovery();">Recovery</button><button class="b1" onclick="reboot();">Retry</button>`, 'Startup Error', '320px');
            }
        }
        function recovery() {
            document.getElementById('nest').innerHTML = `
            <div class="setup">
                <div id="rec1"  style="max-width: 280px;"><p class="h2">Recovery</p>
            <p>You can erase to fix all issues, or wipe the cache/bootload variables to attempt a fix.</p>
            <button class="b1" onclick="burnitall();">Erase</button><button class="b1" onclick="wipeboot();">Delete cache</button><button class="b1" onclick="reboot();">Exit</button></div></div>`
        }

        document.addEventListener('keydown', function (event) {
            if (event.ctrlKey && event.key === 'r') {
                repop();
            }
        });
    </script>
</body>

</html>
